<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8">
        <title>Batalla Pokémon RPG - Estilo Rojo Fuego</title>
        <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

        <style>
            body {
                margin: 0;
                font-family: 'Press Start 2P', monospace;
                background: #7ec0ee;
            }

            /* ================== POKEDEX ================== */
            .pokedex {
                width: 1200px;
                margin: 20px auto;
                background: #c62828;
                border-radius: 30px;
                padding: 20px;
                box-shadow: inset -8px -8px 0 #8e0000,
                    inset 8px 8px 0 #ff5252;
            }

            /* ================== LAYOUT ================== */
            .battle-layout {
                display: grid;
                grid-template-columns: 220px 1fr 220px;
                gap: 14px;
            }

            .side-panel {
                background: #b71c1c;
                border-radius: 16px;
                padding: 10px;
                box-shadow: inset -4px -4px 0 #7f0000,
                    inset 4px 4px 0 #ff5252;
                color: #fff;
                font-size: 10px;
            }

            .panel-title {
                text-align: center;
                margin-bottom: 8px;
                font-weight: bold;
            }

            /* ================== EQUIPO ================== */
            .team-grid {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 6px;
            }

            .team-slot {
                background-image: url("https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/2fb2821a-1406-4a1d-9b04-6668f278e944/d843okx-eb13e8e4-0fa4-4fa9-968a-e0f36ff168de.png/v1/fit/w_800,h_480,q_70,strp/pokemon_x_and_y_battle_background_11_by_phoenixoflight92_d843okx-414w-2x.jpg?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1cm46YXBwOjdlMGQxODg5ODIyNjQzNzNhNWYwZDQxNWVhMGQyNmUwIiwiaXNzIjoidXJuOmFwcDo3ZTBkMTg4OTgyMjY0MzczYTVmMGQ0MTVlYTBkMjZlMCIsIm9iaiI6W1t7ImhlaWdodCI6Ijw9NDgwIiwicGF0aCI6Ii9mLzJmYjI4MjFhLTE0MDYtNGExZC05YjA0LTY2NjhmMjc4ZTk0NC9kODQzb2t4LWViMTNlOGU0LTBmYTQtNGZhOS05NjhhLWUwZjM2ZmYxNjhkZS5wbmciLCJ3aWR0aCI6Ijw9ODAwIn1dXSwiYXVkIjpbInVybjpzZXJ2aWNlOmltYWdlLm9wZXJhdGlvbnMiXX0.TFles5-Ul-mVM-fH7W3coQnMniUUB1lyVY_3PE1Qy6Q");
                background-position: center;
                background-size: cover;
                border: 2px solid #fff;
                border-radius: 8px;
                height: 60px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .team-slot img {
                width: 40px;
                image-rendering: pixelated;
            }

            /* ================== ITEMS ================== */
            .menu-btn {
                width: 100%;
                margin-bottom: 6px;
                font-family: inherit;
                font-size: 10px;
                padding: 8px;
                border-radius: 8px;
                border: 2px solid #000;
                cursor: pointer;
                background: #fff;
            }

            .items-list {
                background: #000;
                border: 2px solid #fff;
                border-radius: 8px;
                padding: 6px;
            }

            .items-list div {
                padding: 4px;
                border-bottom: 1px solid #555;
            }

            .items-list div:last-child {
                border-bottom: none;
            }

            /* ================== SCREEN ================== */
            .screen {
                background-image: url("https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/2fb2821a-1406-4a1d-9b04-6668f278e944/d843okx-eb13e8e4-0fa4-4fa9-968a-e0f36ff168de.png/v1/fit/w_800,h_480,q_70,strp/pokemon_x_and_y_battle_background_11_by_phoenixoflight92_d843okx-414w-2x.jpg?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1cm46YXBwOjdlMGQxODg5ODIyNjQzNzNhNWYwZDQxNWVhMGQyNmUwIiwiaXNzIjoidXJuOmFwcDo3ZTBkMTg4OTgyMjY0MzczYTVmMGQ0MTVlYTBkMjZlMCIsIm9iaiI6W1t7ImhlaWdodCI6Ijw9NDgwIiwicGF0aCI6Ii9mLzJmYjI4MjFhLTE0MDYtNGExZC05YjA0LTY2NjhmMjc4ZTk0NC9kODQzb2t4LWViMTNlOGU0LTBmYTQtNGZhOS05NjhhLWUwZjM2ZmYxNjhkZS5wbmciLCJ3aWR0aCI6Ijw9ODAwIn1dXSwiYXVkIjpbInVybjpzZXJ2aWNlOmltYWdlLm9wZXJhdGlvbnMiXX0.TFles5-Ul-mVM-fH7W3coQnMniUUB1lyVY_3PE1Qy6Q");
                border-radius: 20px;
                padding: 10px;
                border: 6px solid #222;
            }

            .battle-container {
                position: relative;
                width: 100%;
                height: 420px;
                background: url('/mnt/data/5d510005-031e-43e1-8e16-15c761c3248b.png') no-repeat bottom center;
                background-size: cover;
                border-radius: 10px;
                overflow: hidden;
            }

            .pokemon {
                position: absolute;
                width: 180px;
                image-rendering: pixelated;
                transition: transform 0.2s;
                z-index: 2;
            }

            #player-pokemon {
                bottom: 30px;
                right: 60px;
            }

            #cpu-pokemon {
                top: 150px;
                left: 50px;
                transform: scaleX(-1);
            }

            .shadow {
                position: absolute;
                width: 90px;
                height: 20px;
                background: rgba(0,0,0,0.5);
                border-radius: 50%;
                filter: blur(2px);
            }

            #player-shadow {
                bottom: 55px;
                right: 110px;
            }

            #cpu-shadow {
                top: 300px;
                left: 100px;
            }

            /* ================== HUD ================== */
            .hud {
                position: absolute;
                width: 160px;
                background: #f8f8f8;
                border: 3px solid #000;
                box-shadow: 4px 4px 0 #000;
                border-radius: 8px;
                padding: 6px;
                font-size: 10px;
                color: #000;
                z-index: 3;
            }

            .cpu-hud {
                top: 40px;
                left: 60px;
            }

            .player-hud {
                bottom: 210px;
                right: 40px;
            }

            .hp-bar {
                width: 100%;
                height: 10px;
                background: #b0b0b0;
                border: 2px solid #000;
                border-radius: 6px;
                margin-top: 2px;
            }

            .hp-fill {
                height: 100%;
                border-radius: 4px;
            }

            /* ================== CONTROLES ================== */
            .controls-panel {
                margin-top: 14px;
                background: #b71c1c;
                padding: 12px;
                border-radius: 16px;
            }

            .actions {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 8px;
            }

            .actions button {
                font-family: inherit;
                font-size: 10px;
                padding: 10px;
                background: #fff;
                border: 2px solid #000;
                border-radius: 8px;
                cursor: pointer;
            }

            /* ================== LOG ================== */
            .battle-log {
                margin-top: 10px;
                height: 80px;
                background: #000;
                color: #fff;
                border: 4px solid #fff;
                border-radius: 10px;
                padding: 8px;
                font-size: 12px;
                overflow-y: auto;
            }
        </style>
    </head>

    <body>

        <div class="pokedex">

            <div class="battle-layout">

                <!-- PANEL IZQUIERDO -->
                <div class="side-panel">
                    <div class="panel-title">EQUIPO</div>
                    <div class="team-grid" id="player-team-panel">
                    </div>
                </div>

                <!-- CENTRO -->
                <div>
                    <div class="screen">
                        <div class="battle-container">

                            <div class="shadow" id="cpu-shadow"></div>
                            <div class="shadow" id="player-shadow"></div>

                            <img class="pokemon" id="cpu-pokemon" src="">
                            <img class="pokemon" id="player-pokemon" src="">

                            <div class="hud cpu-hud">
                                <div id="cpu-name">CPU</div>
                                <div class="hp-bar"><div class="hp-fill" id="cpu-hp"></div></div>
                            </div>

                            <div class="hud player-hud">
                                <div id="player-name">Jugador</div>
                                <div class="hp-bar"><div class="hp-fill" id="player-hp"></div></div>
                            </div>
                        </div>
                    </div>

                    <div class="controls-panel">
                        <div class="actions">
                            <button>Ataque 1</button>
                            <button>Ataque 2</button>
                            <button>Ataque 3</button>
                            <button>Ataque 4</button>
                        </div>
                    </div>

                    <div class="battle-log" id="battle-log">
                        ¡La batalla comienza!
                    </div>
                </div>

                <!-- PANEL DERECHO -->
                <div class="side-panel">
                    <div class="panel-title">MENÚ</div>
                    <button class="menu-btn">Cambiar Pokémon</button>
                    <button class="menu-btn">Usar objeto</button>

                    <div class="items-list">
                        <div>Poción</div>
                        <div>Superpoción</div>
                        <div>Hiperpoción</div>
                        <div>Revivir</div>
                    </div>
                </div>

            </div>
        </div>

        <script>
            const playerTeam = JSON.parse(localStorage.getItem('player_team')) || [];
            const cpuTeam = [];
            const battleLog = document.getElementById('battle-log');

            function mapCpuPokemon(apiData) {
                return {
                    id: apiData.id,
                    name: apiData.name,
                    hp: apiData.stats[0].base_stat * 2,
                    maxHp: apiData.stats[0].base_stat * 2,
                    atk: apiData.stats[1].base_stat,
                    def: apiData.stats[2].base_stat,
                    type: apiData.types[0].type.name,
                    sprite: apiData.sprites.front_default
                };
            }

            async function generateCpuTeam() {
                for (let i = 0; i < 6; i++) {
                    const id = Math.floor(Math.random() * 1025) + 1;
                    const res = await fetch(`https://pokeapi.co/api/v2/pokemon/${id}`);
                    const data = await res.json();
                    cpuTeam.push(mapCpuPokemon(data));
                }
            }

            let playerIndex = 0, cpuIndex = 0;
            let playerPokemon, cpuPokemon;

            async function startBattle() {
                await generateCpuTeam();
                playerPokemon = playerTeam[playerIndex];
                cpuPokemon = cpuTeam[cpuIndex];
                renderPokemon();
                renderPlayerTeamPanel();
                log('¡La batalla comienza!');
            }

            function renderPokemon() {
                document.getElementById('player-pokemon').src = playerPokemon.sprite;
                document.getElementById('cpu-pokemon').src = cpuPokemon.sprite;

                document.getElementById('player-name').textContent = playerPokemon.name;
                document.getElementById('cpu-name').textContent = cpuPokemon.name;

                document.getElementById('player-hp').style.width =
                        `${(playerPokemon.hp / playerPokemon.maxHp) * 100}%`;
                document.getElementById('player-hp').style.backgroundColor =
                        hpColor(playerPokemon.hp, playerPokemon.maxHp);

                document.getElementById('cpu-hp').style.width =
                        `${(cpuPokemon.hp / cpuPokemon.maxHp) * 100}%`;
                document.getElementById('cpu-hp').style.backgroundColor =
                        hpColor(cpuPokemon.hp, cpuPokemon.maxHp);
            }


            function hpColor(hp, maxHp) {
                const pct = hp / maxHp;
                if (pct > 0.5)
                    return '#4caf50';
                if (pct > 0.2)
                    return '#ffc107';
                return '#f44336';
            }

            function log(text) {
                battleLog.innerHTML += `<p>${text}</p>`;
                battleLog.scrollTop = battleLog.scrollHeight;
            }

            function attack(attacker, defender) {
                if (!attacker || !defender)
                    return false;
                const damage = Math.max(5, Math.floor(attacker.atk - defender.def / 2));
                defender.hp -= damage;
                if (defender.hp < 0)
                    defender.hp = 0;

                const img = attacker === playerPokemon ? document.getElementById('player-pokemon') : document.getElementById('cpu-pokemon');
                img.style.transform = 'translateX(10px)';
                setTimeout(() => img.style.transform = 'translateX(0px)', 150);
                log(`${attacker.name} hace ${damage} de daño a ${defender.name}`);
                renderPokemon();
                return defender.hp <= 0;
            }

            function nextTurn() {
                if (attack(playerPokemon, cpuPokemon)) {
                    log(`${cpuPokemon.name} se debilitó`);
                    cpuIndex++;
                    if (cpuIndex >= cpuTeam.length) {
                        log('¡Ganaste la batalla!');
                        disableAttacks();
                        return;
                    }
                    cpuPokemon = cpuTeam[cpuIndex];
                    log(`CPU envía a ${cpuPokemon.name}`);
                }
                if (cpuPokemon.hp > 0) {
                    if (attack(cpuPokemon, playerPokemon)) {
                        log(`${playerPokemon.name} se debilitó`);
                        playerIndex++;
                        if (playerIndex >= playerTeam.length) {
                            log('¡Perdiste la batalla!');
                            disableAttacks();
                            return;
                        }
                        playerPokemon = playerTeam[playerIndex];
                        log(`Envías a ${playerPokemon.name}`);
                    }
                }
            }

            function disableAttacks() {
                document.querySelectorAll('.actions button').forEach(b => b.disabled = true);
            }

            document.querySelectorAll('.actions button').forEach(b => b.addEventListener('click', nextTurn));

            startBattle();

            function renderPlayerTeamPanel() {
                const panel = document.getElementById('player-team-panel');
                panel.innerHTML = '';

                playerTeam.forEach((pokemon, index) => {
                    const slot = document.createElement('div');
                    slot.classList.add('team-slot');

                    const img = document.createElement('img');
                    img.src = pokemon.sprite;
                    img.alt = pokemon.name;
                    img.title = pokemon.name;

                    // Pokémon activo resaltado
                    if (index === playerIndex) {
                        slot.style.border = '2px solid #4caf50';
                    }

                    slot.appendChild(img);
                    panel.appendChild(slot);
                });

                // Rellenar hasta 6 slots si hay menos
                for (let i = playerTeam.length; i < 6; i++) {
                    const emptySlot = document.createElement('div');
                    emptySlot.classList.add('team-slot');
                    panel.appendChild(emptySlot);
                }
            }
        </script>

    </body>
</html>
